{"version":3,"file":"ScrollHandler.js","names":[],"sources":["../../src/motion/ScrollHandler.ts"],"sourcesContent":["/**\n * ScrollHandler - Scroll velocity and physics tracking\n *\n * Tracks scroll events and generates \"pull forces\" for blob animations.\n */\n\nexport interface ScrollHandlerConfig {\n\tdecayRate?: number;\n\tmaxForces?: number;\n}\n\nexport interface PullForce {\n\tstrength: number;\n\ttime: number;\n\trandomness: number;\n\texplosive: boolean;\n}\n\nexport class ScrollHandler {\n\tprivate stickiness = 0;\n\tprivate lastScrollTime = 0;\n\tprivate scrollVelocity = 0;\n\tprivate decayRate = 0.92;\n\tprivate totalScrollDistance = 0;\n\tprivate scrollStartTime = 0;\n\tprivate isScrolling = false;\n\tprivate scrollDirection = 0;\n\tprivate pullForces: PullForce[] = [];\n\tprivate peakVelocity = 0;\n\n\tconstructor(config?: ScrollHandlerConfig) {\n\t\tif (config?.decayRate) this.decayRate = config.decayRate;\n\t}\n\n\tpublic handleScroll(event: WheelEvent): void {\n\t\tconst currentTime = Date.now();\n\t\tconst deltaTime = currentTime - this.lastScrollTime;\n\n\t\tthis.scrollDirection = event.deltaY > 0 ? 1 : -1;\n\n\t\tif (!this.isScrolling || deltaTime > 200) {\n\t\t\tthis.isScrolling = true;\n\t\t\tthis.scrollStartTime = currentTime;\n\t\t\tthis.totalScrollDistance = 0;\n\t\t\tthis.peakVelocity = 0;\n\t\t}\n\n\t\tthis.totalScrollDistance += Math.abs(event.deltaY);\n\n\t\tconst scrollSpeed = Math.abs(event.deltaY) / Math.max(deltaTime, 16);\n\t\tthis.peakVelocity = Math.max(this.peakVelocity, scrollSpeed);\n\t\tthis.scrollVelocity = this.scrollVelocity * 0.7 + scrollSpeed * 0.3;\n\n\t\tconst speedStickiness = Math.min(this.scrollVelocity / 1.5, 2);\n\t\tconst distanceStickiness = Math.min(this.totalScrollDistance / 400, 2.5);\n\n\t\tconst explosiveThreshold = speedStickiness * distanceStickiness;\n\t\tconst isExplosive =\n\t\t\texplosiveThreshold > 2.0 || (speedStickiness > 1.2 && distanceStickiness > 1.0);\n\n\t\tlet targetStickiness = Math.max(speedStickiness, distanceStickiness * 0.9);\n\t\tif (isExplosive) {\n\t\t\ttargetStickiness = Math.min(targetStickiness * 1.8, 4.0);\n\t\t}\n\n\t\tthis.stickiness = Math.max(this.stickiness, targetStickiness);\n\n\t\tif (speedStickiness > 0.3 || distanceStickiness > 0.3 || isExplosive) {\n\t\t\tthis.generatePullForce(speedStickiness, distanceStickiness, this.scrollDirection, isExplosive);\n\t\t}\n\n\t\tthis.lastScrollTime = currentTime;\n\t\tthis.startDecay();\n\n\t\tsetTimeout(() => {\n\t\t\tif (currentTime - this.lastScrollTime >= 200) {\n\t\t\t\tthis.isScrolling = false;\n\t\t\t\tthis.totalScrollDistance = 0;\n\t\t\t\tthis.peakVelocity = 0;\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tprivate generatePullForce(\n\t\tspeedStickiness: number,\n\t\tdistanceStickiness: number,\n\t\tdirection: number,\n\t\texplosive: boolean\n\t): void {\n\t\tif (direction <= 0 || speedStickiness > 0.4 || distanceStickiness > 0.4 || explosive) {\n\t\t\tlet pullStrength = speedStickiness + distanceStickiness * 0.7;\n\n\t\t\tif (explosive) {\n\t\t\t\tpullStrength = Math.min(pullStrength * 2.5, 8.0);\n\t\t\t} else {\n\t\t\t\tpullStrength = Math.min(pullStrength, 3.0);\n\t\t\t}\n\n\t\t\tconst randomnessFactor = explosive\n\t\t\t\t? 0.6 + Math.random() * 0.4\n\t\t\t\t: 0.4 + Math.random() * 0.5;\n\n\t\t\tthis.pullForces.push({\n\t\t\t\tstrength: pullStrength,\n\t\t\t\ttime: 0,\n\t\t\t\trandomness: randomnessFactor,\n\t\t\t\texplosive: explosive,\n\t\t\t});\n\n\t\t\tif (this.pullForces.length > (explosive ? 10 : 8)) {\n\t\t\t\tthis.pullForces.shift();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate startDecay(): void {\n\t\tconst decay = () => {\n\t\t\tthis.stickiness *= this.decayRate;\n\t\t\tthis.scrollVelocity *= this.decayRate;\n\n\t\t\tthis.pullForces = this.pullForces\n\t\t\t\t.filter((force) => {\n\t\t\t\t\tforce.time += 0.016;\n\t\t\t\t\tconst maxDuration = force.explosive ? 3.5 : 2.0;\n\t\t\t\t\treturn force.time < maxDuration;\n\t\t\t\t})\n\t\t\t\t.map((force) => ({\n\t\t\t\t\t...force,\n\t\t\t\t\tstrength: force.strength * (force.explosive ? 0.995 : 0.98),\n\t\t\t\t}));\n\n\t\t\tif (this.stickiness > 0.01 || this.pullForces.length > 0) {\n\t\t\t\trequestAnimationFrame(decay);\n\t\t\t} else {\n\t\t\t\tthis.stickiness = 0;\n\t\t\t\tthis.scrollVelocity = 0;\n\t\t\t}\n\t\t};\n\t\trequestAnimationFrame(decay);\n\t}\n\n\tpublic getStickiness(): number {\n\t\treturn this.stickiness;\n\t}\n\n\tpublic getScrollVelocity(): number {\n\t\treturn this.scrollVelocity;\n\t}\n\n\tpublic getTotalScrollDistance(): number {\n\t\treturn this.totalScrollDistance;\n\t}\n\n\tpublic getPullForces(): PullForce[] {\n\t\treturn this.pullForces;\n\t}\n\n\tpublic getScrollDirection(): number {\n\t\treturn this.scrollDirection;\n\t}\n\n\tpublic isActivelyScrolling(): boolean {\n\t\treturn this.isScrolling;\n\t}\n\n\tpublic getPeakVelocity(): number {\n\t\treturn this.peakVelocity;\n\t}\n}\n"],"mappings":"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"}